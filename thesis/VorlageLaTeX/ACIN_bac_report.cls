% Package for a Bachalor Reports at CDS-ACIN
% ========================================
%
% DO NOT EDIT THIS FILE!
%
% -----------------------------------------
%
% v1.0: 22.05.2009, Michael Baumgart, based on diploma thesis style by Th. König
% v1.1: 26.05.2009, MB. Added typearea option headinclude and BCOR=6mm
% v2.0: 15.06.2010, MB. Changed title macros, updated logos



% --- Characteristics ---
%=========================
\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{ACIN_bac_report}[2010/06/15 style for ACIN bachelor reports, v2.0, mb]

% --- Initialising ---
%======================
\RequirePackage{ifthen}

\providecommand{\university}{Technischen Universit\"at Wien}
\providecommand{\faculty}{Fakult\"at f\"ur Elektrotechnik und Informationstechnik}
\providecommand{\institute}{Institut f\"ur Automatisierungs- und Regelungstechnik}




% --- declare options ---
%==========================


%================ automatic selection of language-dependent sections
%TODO: change implementation of language support (naustrian oder ngerman?)
	\newboolean{LANGenglish}%
	\setboolean{LANGenglish}{true}%
\DeclareOption{naustrian}{
	\PassOptionsToPackage{USenglish, naustrian}{babel}
	\PassOptionsToClass{naustrian}{scrreprt}
	\setboolean{LANGenglish}{false}
	\AtEndOfClass{\selectlanguage{naustrian}}
}
\DeclareOption{ngerman}{
	\PassOptionsToPackage{USenglish, ngerman}{babel}
	\PassOptionsToClass{ngerman}{scrreprt}
	\setboolean{LANGenglish}{false}
	\AtEndOfClass{\selectlanguage{ngerman}}
}
\DeclareOption{USenglish}{
	\PassOptionsToPackage{ngerman, USenglish}{babel}
	\PassOptionsToClass{USenglish}{scrreprt}
	\AtEndOfClass{\selectlanguage{USenglish}}
}
\newcommand{\GerEng}[2]{\ifthenelse{\boolean{LANGenglish}}{#2}{#1}}


\DeclareOption{Entwurf}{
	\PassOptionsToPackage{timestamp, none, bottom, dark, draft}{draftcopy}
	\AtEndOfClass{
		\RequirePackage[dvips]{draftcopy}
		\draftcopySetGrey{0.6}
		\draftcopyName{Entwurf: \today}{50}
	}
}


\DeclareOption{draft}{
	\PassOptionsToClass{draft}{scrreprt}
}

\DeclareOption{PrintVersion}{
	\PassOptionsToPackage{pdfborder={0 0 0}}{hyperref}
}

\DeclareOption{NoTableOfContents}{\providecommand{\NoTableOfContents}{Dummy}}
\DeclareOption{NoListOfFigures}{\providecommand{\NoListOfFigures}{Dummy}}
\DeclareOption{NoListOfTables}{\providecommand{\NoListOfTables}{Dummy}}

\PassOptionsToPackage{
	ps2pdf,							%% similar to dvips but redefines some macros for use with ps2pdf
	final,
	bookmarks=true,				%% if true, generate PDF bookmarks (requires two passes of pdflatex)
	bookmarksopen=false,			%% if true, show all PDF bookmarks expanded
	bookmarksnumbered=true,		%% if true, add the section numbers to the bookmarks
		linkbordercolor=acin_red,
		urlbordercolor=acin_red,
		citebordercolor=acin_red,
		filebordercolor=acin_red,
	pdfpagemode=UseOutlines, %% None, UseOutlines (=show bookmarks), UseThumbs (show thumbnails), FullScreen
%	breaklinks,
	plainpages=false,
	hyperindex=true,
	%CreationDate=D:20040501215500,
  %ModDate=D:\pdfdate,
}{hyperref}

\AtBeginDocument{
\hypersetup{pdfauthor = {\ACIN@PDFauthor},%
	pdftitle = {\ACIN@PDFtitle},%
	pdfsubject = {\ACIN@PDFsubject}}
}

% --- process options ---
%=========================

\ProcessOptions \relax

% --- load packages ---
%========================

\RequirePackage{babel}

% packages needed for positioning of the boxes on the title page:
\RequirePackage[absolute, overlay]{textpos} %, showboxes
\RequirePackage{calc}


% packages for fonts:
%\RequirePackage{ae}
%\RequirePackage{aecompl}
%\RequirePackage[latin1]{inputenc}		%linux
%\RequirePackage[ansinew]{inputenc}	%windows (works with both)
\RequirePackage[T1]{fontenc}
\RequirePackage{lmodern}
\RequirePackage{textcomp}


%% packages for graphics
%\RequirePackage{float}
\RequirePackage[dvips]{graphicx}
\RequirePackage[dvips]{psfrag}		% replace text in graphics
\RequirePackage{placeins} % places floating objects before new section
% starts, provides \FloatBarrier which will place all remaining floating
% objects.
\RequirePackage[hyperref, dvips]{xcolor}


% packages for math stuff
\RequirePackage{amssymb}
\RequirePackage{amsmath} %[tbtags]
\RequirePackage{amsfonts}
\RequirePackage{bbm}

\RequirePackage{xspace}
\RequirePackage{siunitx} %the squaren option doesn't overwrite the square command from amssymb

%\RequirePackage{prettyref}






\AtEndOfClass{
	% erweiterte Optionen für den Umgang mit dem Literaturverzeichnis
	\RequirePackage[square,sort,compress,numbers]{natbib}

	\RequirePackage{hyperref}
	\RequirePackage[all]{hypcap} % Damit werden die Links auf ein figure nicht mehr auf die Bildunterschrift sondern auf den Begin der Umgebung gesetzt. (must be loaded after hyperref)
}

\PassOptionsToPackage{headinclude}{typearea}


\PassOptionsToClass{
	11pt,
	a4paper,
	parskip=full, 	% kein Absatzeinzug, sondern Abstand (siehe auch halfparskip) oder *,+ und - Variante{scrreprt}
        oneside,       % einseitig bedrucktes Dokument
        BCOR=6mm      % Bindekorrektur
}{scrreprt}



\LoadClass{scrreprt}

% packages for layout
\RequirePackage[automark]{scrpage2}		% Kopf-/Fusszeilen für KOMA-Klassen
\RequirePackage{printlen}
% --- main part ---
%===================

\providecolor{acin_grey}{rgb}{0.6902, 0.6902, 0.6902}
\providecolor{acin_red}{rgb}{0.7294, 0.0706, 0.1686}

\DeclareGraphicsExtensions{.eps}

% general macros
%==================
% title macros
% --------------
% the defintions for these commands following examples at http://www.tex.ac.uk/cgi-bin/texfaq2html?label=oarglikesect
% title
\newcommand{\Title}{\@dblarg\ACIN@title}
\newcommand{\ACIN@title}[2][\@error]{%
 \def\insertTitle{#2}%
  \def\ACIN@shortTitle{#1}%
  }
\Title{<Titel>}


% Subject
\newcommand{\Subject}{\@dblarg\ACIN@subject}
\newcommand{\ACIN@subject}[2][\@error]{%
  \def\insertSubject{#2}%
  \def\ACIN@shortSubject{#1}%
  }
\Subject{Bakkalaureatsarbeit}

% author A
\newcommand{\AuthorA}{\@dblarg\ACIN@authorA}
\newcommand{\ACIN@authorA}[2][\@error]{%
  \def\insertAuthorA{#2}%
  \def\ACIN@shortAuthorA{#1}%
  }
\AuthorA{<Autor A>}
% author B
\newcommand{\AuthorB}{\@dblarg\ACIN@authorB}
\newcommand{\ACIN@authorB}[2][\@error]{%
  \def\insertAuthorB{#2}%
  \def\ACIN@shortAuthorB{#1}%
  }
\AuthorB{}
% author C
\newcommand{\AuthorC}{\@dblarg\ACIN@authorC}
\newcommand{\ACIN@authorC}[2][\@error]{%
  \def\insertAuthorC{#2}%
  \def\ACIN@shortAuthorC{#1}%
  }
\AuthorC{}
% author address A
\newcommand{\AuthorAddressA}{\@dblarg\ACIN@authoraddressA}
\newcommand{\ACIN@authoraddressA}[2][\@error]{%
  \def\insertAuthorAddressA{#2}%
  \def\ACIN@shortAuthoraddressA{#1}%
  }
\AuthorAddressA{Matrikelnr. a000000\\<Strasse>\\<Ort>}
% author address B
\newcommand{\AuthorAddressB}{\@dblarg\ACIN@authoraddressB}
\newcommand{\ACIN@authoraddressB}[2][\@error]{%
  \def\insertAuthorAddressB{#2}%
  \def\ACIN@shortAuthoraddressB{#1}%
  }
\AuthorAddressB{}
% author address C
\newcommand{\AuthorAddressC}{\@dblarg\ACIN@authoraddressC}
\newcommand{\ACIN@authoraddressC}[2][\@error]{%
  \def\insertAuthorAddressC{#2}%
  \def\ACIN@shortAuthoraddressC{#1}%
  }
\AuthorAddressC{}

% supervisor
\newcommand{\Supervisor}{\@dblarg\ACIN@supervisor}
\newcommand{\ACIN@supervisor}[2][\@error]{%
  \def\insertSupervisor{#2}%
  \def\ACIN@shortSupervisor{#1}%
  }
\Supervisor{<Betreuer>}

% Place and Time
\newcommand{\PlaceAndTime}{\@dblarg\ACIN@placeandtime}
\newcommand{\ACIN@placeandtime}[2][\@error]{%
  \def\insertPlaceAndTime{#2}%
  \def\ACIN@shortPlaceAndTime{#1}%
  }
\PlaceAndTime{<Ort, im Monat Jahr>}

% date
\newcommand{\Date}{\@dblarg\ACIN@date}
\newcommand{\ACIN@date}[2][\@error]{%
  \def\insertDate{#2}%
  \def\ACIN@shortDate{#1}%
  }
\Date{\today}

% PDFTitle nur notwendig, falls von Title abweichend. (Z.Bsp. falls Titel Zeilenumbrüche enthält)
% author
\newcommand\PDFAuthor[1]{\long\def\ACIN@PDFauthor{#1}}
%\long\def\ACIN@PDFauthor{#1}
\PDFAuthor{\ACIN@shortAuthorA,\ACIN@shortAuthorB,\ACIN@shortAuthorC}

\newcommand\PDFTitle[1]{\long\def\ACIN@PDFtitle{#1}}
%\long\def\ACIN@PDFtitle{#1}
\PDFTitle{\ACIN@shortTitle}

\newcommand\PDFSubject[1]{\long\def\ACIN@PDFsubject{#1}}
%\long\def\ACIN@PDFsubject{#1}
\PDFSubject{\ACIN@shortSubject}


% text macros
%-------------

% +++ English
\providecommand{\ie}{i.\,e.\@\xspace} % .\@ is not treated as a full stop (important for the length of the whitespace afterwards. \@. is always treated as a full stop.)
\providecommand{\eg}{e.\,g.\@\xspace}

% +++ German
\providecommand{\zB}{z.\,B.\@\xspace}
\providecommand{\bzw}{bzw.\@\xspace}
\AtEndOfClass{\renewcommand{\dh}{d.\,h.\@\xspace}}
\providecommand{\ua}{u.\,a.\@\xspace}
\providecommand{\sog}{sog.\@\xspace}
\providecommand{\usw}{usw.\@\xspace}

%
% \providecommand{\MatlabSimulink}{\textsc{Matlab/Simulink}\xspace}

%


\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{3}


% +++++++++++++++++++++++++++
% + 												+
% + Kopf- und Fußzeilen 		+
% + 												+
% +++++++++++++++++++++++++++


%\pagestyle{scrheadings}
% umdefinieren der 'normalen' Kopf-/Fusszeilen:
% ihead: innere Kopfzeile, ohead: äußere Kopfzeile, cfoot: mittlere Fusszeile
% [Definition für scrplain]{Definition für scrheadings}
% scrplain wird bei Seiten mit neuem Kapitel verwendet, scrheadings sonst
\setheadsepline{.4pt}		% Linie zwischen Kopfzeile und Text
%\setfootsepline{.4pt}		% Linie zwischen Fusszeile und Text
\automark[section]{chapter}	%leftmark wird durch subsection, rightmark durch section aktualisiert
\clearscrheadfoot 		% lösche bisherige Definition vollständig
\ihead[]{\leftmark} 	%evtl. \thesection \thechapter etc. verwenden
\ohead[]{\sl\rightmark}
\cfoot[\rm\thepage]{\rm\thepage}



\newpagestyle{Preface} % neuer Seitenstil
  %Seitenkopf:
	{
		{\headmark\hfill\bf\thepage} % Gerade Seite
		{\bf\thepage\hfill\headmark} % Ungerade Seite
		{\headmark\hfill\bf\thepage} % Einseitiges Layout
	}
	%Seitenfuss:
	{
		{\hfill}
		{\hfill}
		{\hfill}
	}

%----- modify pagesetup and headings
% \textheight 22cm
% \textwidth 16cm
% \oddsidemargin 8mm
% \topmargin 0pt
% \headheight 17pt


% ======================
% ||   hyphen rules   ||
% ======================

% TODO: Check if files are available, warning if not!

	\IfFileExists{hyphen_german.tex}{
		\begin{otherlanguage*}{ngerman}
			{\input{hyphen_german.tex}}
		\end{otherlanguage*}
		\begin{otherlanguage*}{naustrian}
			{\input{hyphen_german.tex}}
		\end{otherlanguage*}
	}{
		\ClassWarningNoLine{ACIN_diploma_thesis}{File hyphen_german.tex does not exist!}
	}
	\IfFileExists{hyphen_english.tex}{
		\begin{otherlanguage*}{USenglish}{
			{\input{hyphen_english.tex}}
		}\end{otherlanguage*}
	}{
		\ClassWarningNoLine{ACIN_diploma_thesis}{File hyphen_english.tex does not exist!}
	}

% \begin{textblock}{breite}(x,y)
% Objekt
% \end{textblock}
%
%Die Argumente breite und x sind Vielfache des horizontalen Längenparameters \TPHorizModule, y ein Vielfaches von %\TPVertModule. Stellt man die Parameter auf einen Millimeter (mm) ein, dann kann jede Position mittels eines %Lineals abgelesen werden.
%
\setlength{\TPHorizModule}{1mm}
\setlength{\TPVertModule}{1mm}


% ===================
% ||   maketitle   ||
% ===================

\renewcommand{\maketitle}{
\begin{titlepage}
	\sffamily
    \enlargethispage{5cm}
    \unitlength 1cm


	\begin{textblock*}{197mm}[0, 0](6mm, 8mm)
		\includegraphics[width=197mm,keepaspectratio]{graphics/logos/Titel_BakkArbeit}
	\end{textblock*}
	\begin{textblock*}{197mm}(6mm, 2.1cm)
		\noindent
		\centering
		\rule{197mm}{0.02cm}
	\end{textblock*}

	\begin{textblock*}{\textwidth}[0.5,0.5](\hoffset+\oddsidemargin+1in +0.5\textwidth, 5.9cm)
		\noindent
		\centering
		\huge
		\insertTitle
	\end{textblock*}

 	\begin{textblock*}{\textwidth}[0.5,0](\hoffset+\oddsidemargin+1in +0.5\textwidth, 9.4cm)
 		\centering
                \LARGE{Bakkalaureatsarbeit}\\[2ex]
                \Large{erstellt von}\\[2ex]
                \LARGE{\insertAuthorA}\\[1ex]
                \large{\insertAuthorAddressA}\\[2ex]
                % \LARGE{\insertAuthorB}\\[1ex]
                % \large{\insertAuthorAddressB}\\[2ex]
                % \LARGE{\insertAuthorC}\\[1ex]
                % \large{\insertAuthorAddressC}
 	 	\end{textblock*}
	\begin{textblock*}{\textwidth}[0.5,0](\hoffset+\oddsidemargin+1in +0.5\textwidth,21.5cm)
 		\centering
              \Large
               Betreuer\\
 		\vspace{0.3cm}
 		{\LARGE \insertSupervisor}\\
 		\vspace{1.2cm}	
 		\vspace{0.8cm}
 		\insertPlaceAndTime
 	\end{textblock*}
	\begin{textblock*}{197mm}[0,1](6mm, 29cm)
		%\rmfamily
		\centering
		\noindent
		\rule{197mm}{0.02cm}
		{\small \bfseries Gruppe f\"ur komplexe dynamische Systeme\\}
		{\small A-1040 Wien, Gusshausstr. 27-29, Internet: http://www.acin.tuwien.ac.at\\}
		\vspace*{-0.2cm}
		\rule{197mm}{0.02cm}
	\end{textblock*}

	\hspace{0mm}
	\clearpage
	\end{titlepage}


	\setcounter{page}{1}

	% Include all the preface-stuff...
	%==================================
	\pagestyle{Preface}
	\pagenumbering{Roman}

	\GerEng{\begin{hyphenrules}{ngerman}}{}
		\InputIfFileExists{
			pre1_Kurzzusammenfassung
		}{}{
			\ClassError{ACIN_bac_report}{File pre2_Abstract does not exist!}{The file pre2_Kurzzusammenfassung.tex must exist!}
		}
	\GerEng{\end{hyphenrules}}{}

	\GerEng{}{\begin{hyphenrules}{USenglish}}
		\InputIfFileExists{
			pre2_Abstract
		}{}{
			\ClassError{ACIN_bac_report}{File pre3_Kurzzusammenfassung does not exist!}{The file pre2_Abstract.tex must exist!}
		}
	\GerEng{}{\end{hyphenrules}}


	% Create table of contents, figures...
	%======================================

	%TODO Nicht sehr optimal gelöst (selectlanguage)
	\GerEng{\selectlanguage{ngerman}}{}

	\ifdefined\NoTableOfContents
	\else
		\tableofcontents
	\fi
	\ifdefined\NoListOfFigures
	\else
		\listoffigures
	\fi
	\ifdefined\NoListOfTables
	\else
		\listoftables
	\fi


	\pagestyle{scrheadings}
	\clearpage
	\pagenumbering{arabic}


}


\AtEndDocument{
	% Bibliography...
	%=================
	\GerEng{
		\bibliographystyle{IEEEtranS_de}
	}{
		\bibliographystyle{IEEEtranS}
	}
	\bibliography{bibliography}

 % Eidesstattliche Erklärung
	%===========================
	% Eidesstattliche Erklärung ohne Seitennummer am Ende des Dokumentes.
	\addchap*{Eidesstattliche Erklärung}
	\thispagestyle{empty}

		\noindent Hiermit erkläre ich, dass die vorliegende Arbeit ohne unzulässige Hilfe 	Dritter und ohne Benutzung anderer als der angegebenen Hilfsmittel angefertigt wurde. Die aus anderen Quellen oder indirekt übernommenen Daten und Konzepte sind unter Angabe der Quelle gekennzeichnet.
	Die Arbeit wurde bisher weder im In- noch im Ausland in gleicher oder in ähnlicher Form in anderen Prüfungsverfahren vorgelegt.\vspace{3cm}

	\noindent%
	\insertPlaceAndTime

	\begin{flushright}
	\rule{5cm}{0.01cm}
	\end{flushright}

}
